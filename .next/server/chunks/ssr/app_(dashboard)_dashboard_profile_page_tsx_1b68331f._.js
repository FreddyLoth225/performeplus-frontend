module.exports=[33919,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(95245),e=a.i(59501),f=a.i(70025),g=a.i(37927),h=a.i(23292),i=a.i(56757);let j=(a,b)=>i.z.union([i.z.string().max(a,b),i.z.literal("")]).optional(),k=i.z.union([i.z.string().regex(/^\+?1?\d{9,15}$/,"Format de téléphone invalide"),i.z.literal("")]).optional(),l=i.z.object({nom:j(50,"50 caractères maximum"),prenoms:j(100,"100 caractères maximum"),telephone:k,whatsapp:k,langue:i.z.enum(["fr","en","pt","ar","es","sw"]),fuseau_horaire:i.z.string().min(1,"Fuseau horaire requis")}),m=i.z.object({old_password:i.z.string().min(1,"Ancien mot de passe requis"),password:i.z.string().min(8,"Au moins 8 caractères").regex(/^(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/,"Inclure une majuscule, un chiffre et un caractère spécial"),confirm_password:i.z.string().min(1,"Confirmation requise")}).refine(a=>a.password===a.confirm_password,{message:"Les mots de passe ne correspondent pas",path:["confirm_password"]}),n=i.z.object({new_email:i.z.string().email("Email invalide"),password:i.z.string().min(1,"Mot de passe requis")});var o=a.i(62477);let p={async updateProfile(a){let{photo:b,remove_photo:c,...d}=a,e={};if(Object.entries(d).forEach(([a,b])=>{void 0!==b&&(e[a]=null===b?"":b)}),void 0!==c&&(e.remove_photo=c),b instanceof File){let a=new FormData;return a.append("photo",b),Object.entries(e).forEach(([b,c])=>{if(void 0!==c){if(null===c)return void a.append(b,"");a.append(b,"boolean"==typeof c?String(c):c)}}),(await o.apiClient.patch("/profil/",a,{headers:{"Content-Type":"multipart/form-data"}})).data}return(await o.apiClient.patch("/profil/",e)).data},requestEmailChange:async a=>(await o.apiClient.post("/change-email/request/",a)).data};var q=a.i(36608),r=a.i(97204),s=a.i(3130),t=a.i(17171),u=a.i(5522),v=a.i(40695),w=a.i(7706),x=a.i(54161),y=a.i(87682),z=a.i(46143),A=a.i(96221),B=a.i(73320),C=a.i(81560);let D=(0,a.i(70106).default)("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var E=a.i(92258);let F=[{value:"fr",label:"Français"},{value:"en",label:"Anglais"},{value:"pt",label:"Portugais"},{value:"ar",label:"Arabe"},{value:"es",label:"Espagnol"},{value:"sw",label:"Swahili"}],G={NORMAL:"Utilisateur",AGENT_PP:"Agent PP",DIRECTEUR_PP:"Directeur PP"},H=["UTC","Africa/Abidjan","Africa/Dakar","Africa/Algiers","Europe/Paris","Europe/London","America/New_York","America/Los_Angeles","America/Sao_Paulo","Asia/Dubai","Asia/Tokyo"];function I(a){let b=a?.response?.data;if(!b)return"Une erreur est survenue";if("string"==typeof b)return b;if(b.message)return b.message;if(b.detail)return b.detail;if(Array.isArray(b.non_field_errors)&&b.non_field_errors.length)return b.non_field_errors[0];let c=Object.keys(b)[0];return c&&Array.isArray(b[c])&&b[c].length?b[c][0]:"Une erreur est survenue"}function J(){let{user:a,setUser:i}=(0,q.useAuthStore)(),j=(0,g.useQueryClient)(),k=(0,c.useRef)(null),[o,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(null),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)(H),Q=(0,d.useForm)({resolver:(0,e.zodResolver)(l),defaultValues:{nom:"",prenoms:"",telephone:"",whatsapp:"",langue:"fr",fuseau_horaire:"UTC"}}),R=(0,d.useForm)({resolver:(0,e.zodResolver)(m),defaultValues:{old_password:"",password:"",confirm_password:""}}),S=(0,d.useForm)({resolver:(0,e.zodResolver)(n),defaultValues:{new_email:"",password:""}});(0,c.useEffect)(()=>{},[]),(0,c.useEffect)(()=>{if(a){let b=F.some(b=>b.value===a.langue)?a.langue:"fr",c=a.fuseau_horaire||"UTC";Q.reset({nom:a.nom||"",prenoms:a.prenoms||"",telephone:a.telephone||"",whatsapp:a.whatsapp||"",langue:b,fuseau_horaire:c}),J(a.photo??null),L(null),N(!1)}},[a,Q]),(0,c.useEffect)(()=>{a?.fuseau_horaire&&P(b=>b.includes(a.fuseau_horaire)?b:[a.fuseau_horaire,...b])},[a?.fuseau_horaire]),(0,c.useEffect)(()=>()=>{o&&o.startsWith("blob:")&&URL.revokeObjectURL(o)},[o]);let T=a=>{i(a.profil),j.setQueryData(["current-user"],a.profil),h.toast.success(a.message)},U=(0,f.useMutation)({mutationFn:a=>p.updateProfile(a),onSuccess:a=>{T(a),o&&o.startsWith("blob:")&&URL.revokeObjectURL(o),L(null),N(!1),J(a.profil.photo??null)},onError:a=>{h.toast.error(I(a))}}),V=(0,f.useMutation)({mutationFn:a=>p.updateProfile(a),onSuccess:a=>{T(a),R.reset()},onError:a=>{h.toast.error(I(a))}}),W=(0,f.useMutation)({mutationFn:a=>p.updateProfile(a),onSuccess:a=>{T(a)},onError:a=>{h.toast.error(I(a))}}),X=(0,f.useMutation)({mutationFn:p.requestEmailChange,onSuccess:a=>{h.toast.success(a.message),S.reset()},onError:a=>{h.toast.error(I(a))}}),Y=(0,c.useMemo)(()=>{if(!a)return"??";let b=(a.prenoms||"").charAt(0),c=(a.nom||"").charAt(0);return`${b}${c}`.trim().toUpperCase()||"??"},[a]);if(!a)return(0,b.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center",children:(0,b.jsx)(A.Loader2,{className:"h-6 w-6 animate-spin text-primary"})});let Z=Q.formState.errors,$=R.formState.errors,_=S.formState.errors;return(0,b.jsxs)("div",{className:"p-8 space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Mon profil"}),(0,b.jsx)(x.Badge,{variant:"secondary",children:G[a.rolePlateforme]})]}),(0,b.jsx)("p",{className:"text-slate-600",children:"Mettez à jour vos informations personnelles, vos préférences et la sécurité du compte."})]}),(0,b.jsxs)("div",{className:"grid gap-6 max-w-4xl",children:[(0,b.jsxs)(s.Card,{children:[(0,b.jsxs)(s.CardHeader,{children:[(0,b.jsx)(s.CardTitle,{children:"Informations générales"}),(0,b.jsx)(s.CardDescription,{children:"Photo, identité et coordonnées visibles sur la plateforme."})]}),(0,b.jsx)(s.CardContent,{children:(0,b.jsxs)("form",{onSubmit:Q.handleSubmit(a=>{U.mutate({nom:a.nom?.trim()??"",prenoms:a.prenoms?.trim()??"",telephone:a.telephone?.trim()??"",whatsapp:a.whatsapp?.trim()??"",langue:a.langue,fuseau_horaire:a.fuseau_horaire,photo:K??void 0,remove_photo:!!M||void 0})}),className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,b.jsxs)(w.Avatar,{className:"h-20 w-20",children:[(0,b.jsx)(w.AvatarImage,{src:o??void 0,alt:"Photo de profil"}),(0,b.jsx)(w.AvatarFallback,{children:Y})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsxs)(v.Button,{type:"button",variant:"outline",onClick:()=>k.current?.click(),disabled:U.isPending,children:[(0,b.jsx)(B.Upload,{className:"h-4 w-4 mr-2"}),"Changer la photo"]}),(0,b.jsxs)(v.Button,{type:"button",variant:"ghost",onClick:()=>{o&&o.startsWith("blob:")&&URL.revokeObjectURL(o),J(null),L(null),N(!0)},disabled:U.isPending||!o&&!K,children:[(0,b.jsx)(C.Trash2,{className:"h-4 w-4 mr-2"}),"Supprimer"]}),(0,b.jsx)("input",{ref:k,type:"file",accept:"image/png,image/jpeg,image/webp",className:"hidden",onChange:a=>(a=>{if(a){if(a.size>5242880)return void h.toast.error("La photo ne doit pas dépasser 5MB");if(!["image/jpeg","image/png","image/webp"].includes(a.type))return void h.toast.error("Formats acceptés : JPG, PNG ou WEBP");J(b=>(b&&b.startsWith("blob:")&&URL.revokeObjectURL(b),URL.createObjectURL(a))),L(a),N(!1)}})(a.target.files?.[0])})]})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"prenoms",children:"Prénoms"}),(0,b.jsx)(u.Input,{id:"prenoms",...Q.register("prenoms")}),Z.prenoms&&(0,b.jsx)("p",{className:"text-sm text-danger",children:Z.prenoms.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"nom",children:"Nom"}),(0,b.jsx)(u.Input,{id:"nom",...Q.register("nom")}),Z.nom&&(0,b.jsx)("p",{className:"text-sm text-danger",children:Z.nom.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"telephone",children:"Téléphone"}),(0,b.jsx)(u.Input,{id:"telephone",placeholder:"Ex: +221770000000",...Q.register("telephone")}),Z.telephone&&(0,b.jsx)("p",{className:"text-sm text-danger",children:Z.telephone.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"whatsapp",children:"Numéro WhatsApp"}),(0,b.jsx)(u.Input,{id:"whatsapp",placeholder:"Ex: +221770000000",...Q.register("whatsapp")}),Z.whatsapp&&(0,b.jsx)("p",{className:"text-sm text-danger",children:Z.whatsapp.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{children:"Langue préférée"}),(0,b.jsx)(d.Controller,{control:Q.control,name:"langue",render:({field:a})=>(0,b.jsxs)(y.Select,{value:a.value,onValueChange:a.onChange,children:[(0,b.jsx)(y.SelectTrigger,{className:"w-full",children:(0,b.jsx)(y.SelectValue,{placeholder:"Choisir une langue"})}),(0,b.jsx)(y.SelectContent,{children:F.map(a=>(0,b.jsx)(y.SelectItem,{value:a.value,children:a.label},a.value))})]})}),Z.langue&&(0,b.jsx)("p",{className:"text-sm text-danger",children:Z.langue.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{children:"Fuseau horaire"}),(0,b.jsx)(d.Controller,{control:Q.control,name:"fuseau_horaire",render:({field:a})=>(0,b.jsxs)(y.Select,{value:a.value,onValueChange:a.onChange,children:[(0,b.jsx)(y.SelectTrigger,{className:"w-full",children:(0,b.jsx)(y.SelectValue,{placeholder:"Choisir un fuseau"})}),(0,b.jsx)(y.SelectContent,{className:"max-h-72",children:O.map(a=>(0,b.jsx)(y.SelectItem,{value:a,children:a},a))})]})}),Z.fuseau_horaire&&(0,b.jsx)("p",{className:"text-sm text-danger",children:Z.fuseau_horaire.message})]})]}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)(v.Button,{type:"submit",disabled:U.isPending,children:U.isPending?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(A.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Sauvegarde..."]}):"Enregistrer les modifications"})})]})})]}),(0,b.jsxs)(s.Card,{children:[(0,b.jsxs)(s.CardHeader,{children:[(0,b.jsx)(s.CardTitle,{children:"Sécurité"}),(0,b.jsx)(s.CardDescription,{children:"Activez l’authentification à deux facteurs et mettez à jour votre mot de passe."})]}),(0,b.jsxs)(s.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4 rounded-lg border p-4",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(D,{className:"h-4 w-4 text-primary"}),(0,b.jsx)("p",{className:"font-medium",children:"Double authentification par email"})]}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"Recevez un code par email à chaque connexion."})]}),(0,b.jsx)(z.Checkbox,{id:"two-factor",checked:a.deuxFacteursActif,disabled:W.isPending,onCheckedChange:b=>(b=>{if(!a)return;let c=a.rolePlateforme===r.RolePlateforme.AGENT_PP||a.rolePlateforme===r.RolePlateforme.DIRECTEUR_PP;!b&&c?h.toast.info("La double authentification est obligatoire pour votre rôle"):W.mutate({deuxFacteursActif:b})})(!0===b)})]}),(0,b.jsxs)("form",{onSubmit:R.handleSubmit(a=>{V.mutate({old_password:a.old_password,password:a.password})}),className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"old_password",children:"Ancien mot de passe"}),(0,b.jsx)(u.Input,{id:"old_password",type:"password",autoComplete:"current-password",...R.register("old_password")}),$.old_password&&(0,b.jsx)("p",{className:"text-sm text-danger",children:$.old_password.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"password",children:"Nouveau mot de passe"}),(0,b.jsx)(u.Input,{id:"password",type:"password",autoComplete:"new-password",...R.register("password")}),$.password&&(0,b.jsx)("p",{className:"text-sm text-danger",children:$.password.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"confirm_password",children:"Confirmation"}),(0,b.jsx)(u.Input,{id:"confirm_password",type:"password",autoComplete:"new-password",...R.register("confirm_password")}),$.confirm_password&&(0,b.jsx)("p",{className:"text-sm text-danger",children:$.confirm_password.message})]})]}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)(v.Button,{type:"submit",disabled:V.isPending,children:V.isPending?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(A.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Mise à jour..."]}):"Modifier le mot de passe"})})]})]})]}),(0,b.jsxs)(s.Card,{children:[(0,b.jsxs)(s.CardHeader,{children:[(0,b.jsx)(s.CardTitle,{children:"Changement d’email"}),(0,b.jsx)(s.CardDescription,{children:"Un lien de confirmation sera envoyé à votre nouvelle adresse."})]}),(0,b.jsx)(s.CardContent,{children:(0,b.jsxs)("form",{onSubmit:S.handleSubmit(a=>{X.mutate(a)}),className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"new_email",children:"Nouvel email"}),(0,b.jsx)(u.Input,{id:"new_email",type:"email",placeholder:"nouveau@email.com",...S.register("new_email")}),_.new_email&&(0,b.jsx)("p",{className:"text-sm text-danger",children:_.new_email.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"email_password",children:"Mot de passe actuel"}),(0,b.jsx)(u.Input,{id:"email_password",type:"password",...S.register("password")}),_.password&&(0,b.jsx)("p",{className:"text-sm text-danger",children:_.password.message})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,b.jsx)(E.Mail,{className:"h-4 w-4"}),(0,b.jsx)("p",{children:"Confirmez le lien reçu pour finaliser le changement."})]}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)(v.Button,{type:"submit",disabled:X.isPending,children:X.isPending?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(A.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Envoi en cours..."]}):"Envoyer la demande"})})]})})]})]})]})}a.s(["default",()=>J],33919)}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_profile_page_tsx_1b68331f._.js.map