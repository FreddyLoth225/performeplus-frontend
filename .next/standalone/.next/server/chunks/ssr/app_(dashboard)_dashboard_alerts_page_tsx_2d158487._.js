module.exports=[49847,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(33217),e=a.i(70025),f=a.i(37927),g=a.i(62477);let h={async getAlerts(a){let b=new URLSearchParams;return Object.entries(a).forEach(([a,c])=>{void 0!==c&&b.append(a,c.toString())}),(await g.apiClient.get(`/alertes/?${b.toString()}`)).data.alertes||[]},getAlert:async a=>(await g.apiClient.get(`/alertes/${a}/`)).data,markAsRead:async a=>(await g.apiClient.patch(`/alertes/${a}/`,{action:"marquer_lue"})).data,treatAlert:async(a,b)=>(await g.apiClient.patch(`/alertes/${a}/`,{action:"traiter",action_corrective:b.action_corrective,commentaire:b.commentaire})).data};var i=a.i(23292),j=a.i(42550),k=a.i(56711),l=a.i(50603),m=a.i(3130),n=a.i(54161),o=a.i(73570),p=a.i(92e3),q=a.i(97063),r=a.i(50522);let s=(0,a.i(70106).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var t=a.i(97895);let u={CRITIQUE:{icon:o.AlertTriangle,color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",badgeClass:"bg-red-100 text-red-700 border-red-200"},ATTENTION:{icon:p.AlertCircle,color:"text-orange-600",bgColor:"bg-orange-50",borderColor:"border-orange-200",badgeClass:"bg-orange-100 text-orange-700 border-orange-200"},INFO:{icon:q.Info,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",badgeClass:"bg-blue-100 text-blue-700 border-blue-200"}},v={SURCHARGE:"Surcharge",SOUS_CHARGE:"Sous-charge",MONOTONIE:"Monotonie",INDICE_FORME_BAS:"Forme basse",INDICE_FORME_TRES_BAS:"Forme très basse",SAISIE_MANQUANTE_RPE:"RPE manquant",SAISIE_MANQUANTE_FORME:"Indice de forme manquant"};function w({alerts:a,onSelectAlert:c}){return 0===a.length?(0,b.jsx)(m.Card,{children:(0,b.jsxs)(m.CardContent,{className:"flex flex-col items-center justify-center h-96 text-center",children:[(0,b.jsx)(q.Info,{className:"h-12 w-12 text-slate-300 mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Aucune alerte"}),(0,b.jsx)("p",{className:"text-slate-600",children:"Tout va bien ! Aucune anomalie détectée."})]})}):(0,b.jsx)("div",{className:"space-y-3",children:a.map(a=>{let d=u[a.niveau],e=d.icon;return(0,b.jsx)(m.Card,{className:(0,t.cn)("hover:shadow-md transition-shadow cursor-pointer border-l-4",d.borderColor,!a.lue&&"bg-slate-50"),onClick:()=>c(a.id),children:(0,b.jsx)(m.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:(0,t.cn)("w-10 h-10 rounded-lg flex items-center justify-center",d.bgColor),children:(0,b.jsx)(e,{className:(0,t.cn)("h-5 w-5",d.color)})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(n.Badge,{variant:"outline",className:d.badgeClass,children:v[a.type]}),(0,b.jsx)("span",{className:"text-xs text-slate-500",children:(0,k.format)(new Date(a.dateCreation),"PPp",{locale:l.fr})}),!a.lue&&(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-primary"})]}),(0,b.jsx)("p",{className:"text-sm text-slate-900 font-medium mb-1",children:a.message}),a.joueur_nom&&(0,b.jsxs)("div",{className:"flex items-center gap-1 text-xs text-slate-600",children:[(0,b.jsx)(s,{className:"h-3 w-3"}),a.joueur_nom]})]}),(0,b.jsx)(r.ChevronRight,{className:"h-5 w-5 text-slate-400 flex-shrink-0"})]})})},a.id)})})}var x=a.i(65733),y=a.i(40695),z=a.i(46893),A=a.i(17171),B=a.i(7379),C=a.i(96221),D=a.i(16201);let E={CRITIQUE:"bg-red-100 text-red-700 border-red-200",ATTENTION:"bg-orange-100 text-orange-700 border-orange-200",INFO:"bg-blue-100 text-blue-700 border-blue-200"},F={SURCHARGE:"Surcharge",SOUS_CHARGE:"Sous-charge",MONOTONIE:"Monotonie",INDICE_FORME_BAS:"Forme basse",INDICE_FORME_TRES_BAS:"Forme très basse",SAISIE_MANQUANTE_RPE:"RPE manquant",SAISIE_MANQUANTE_FORME:"Indice de forme manquant"};function G({alerteId:a,open:g,onOpenChange:j}){let m,o,{data:p,isLoading:q}=(0,d.useQuery)({queryKey:["alert",a],queryFn:()=>h.getAlert(a),enabled:!!a});m=(0,f.useQueryClient)(),(0,e.useMutation)({mutationFn:a=>h.markAsRead(a),onSuccess:()=>{m.invalidateQueries({queryKey:["alerts"]})}});let r=(o=(0,f.useQueryClient)(),(0,e.useMutation)({mutationFn:({alerteId:a,data:b})=>h.treatAlert(a,b),onSuccess:()=>{o.invalidateQueries({queryKey:["alerts"]}),i.toast.success("Alerte traitée")},onError:a=>{let b=a.response?.data?.message||"Erreur lors du traitement";i.toast.error(b)}})),[t,u]=(0,c.useState)(""),v=async()=>{a&&(await r.mutateAsync({alerteId:a,data:{action_corrective:t}}),j(!1))};return g&&a?(0,b.jsx)(x.Dialog,{open:g,onOpenChange:j,children:(0,b.jsx)(x.DialogContent,{className:"sm:max-w-[600px]",children:q?(0,b.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,b.jsx)(C.Loader2,{className:"h-8 w-8 animate-spin text-primary"})}):p?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(x.DialogHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(x.DialogTitle,{className:"text-xl",children:F[p.type]}),(0,b.jsx)(x.DialogDescription,{className:"mt-2",children:(0,k.format)(new Date(p.dateCreation),"PPP à HH:mm",{locale:l.fr})})]}),(0,b.jsx)(n.Badge,{variant:"outline",className:E[p.niveau],children:p.niveau})]})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"p-4 bg-slate-50 rounded-lg",children:(0,b.jsx)("p",{className:"text-slate-900",children:p.message})}),p.joueur_nom&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(s,{className:"h-4 w-4 text-slate-500"}),(0,b.jsx)("span",{className:"font-medium",children:p.joueur_nom})]}),p.interpretation_type&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(B.Separator,{}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium text-sm mb-2",children:"Détails :"}),(0,b.jsx)("div",{className:"text-sm text-slate-600 space-y-1",children:Object.entries(p.interpretation_type).map(([a,c])=>(0,b.jsxs)("div",{children:[(0,b.jsxs)("span",{className:"font-medium",children:[a," :"]})," ",String(c)]},a))})]})]}),p.traitee&&p.actionCorrective&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(B.Separator,{}),(0,b.jsxs)("div",{className:"p-4 bg-green-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(D.CheckCircle,{className:"h-5 w-5 text-green-600"}),(0,b.jsx)("span",{className:"font-medium text-green-900",children:"Alerte traitée"})]}),(0,b.jsx)("p",{className:"text-sm text-green-800",children:p.actionCorrective})]})]}),!p.traitee&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(B.Separator,{}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(A.Label,{htmlFor:"action",children:"Action corrective"}),(0,b.jsx)(z.Textarea,{id:"action",value:t,onChange:a=>u(a.target.value),placeholder:"Décrivez l'action mise en place...",rows:3})]})]})]}),(0,b.jsx)(x.DialogFooter,{children:p.traitee?(0,b.jsx)(y.Button,{onClick:()=>j(!1),children:"Fermer"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(y.Button,{variant:"outline",onClick:()=>j(!1),children:"Fermer"}),(0,b.jsxs)(y.Button,{onClick:v,disabled:r.isPending||!t.trim(),children:[r.isPending&&(0,b.jsx)(C.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Marquer comme traitée"]})]})})]}):(0,b.jsx)("div",{className:"text-center py-8",children:(0,b.jsx)("p",{className:"text-slate-600",children:"Alerte introuvable"})})})}):null}var H=a.i(21958);function I(){var a;let{currentTeam:e}=(0,j.useTeamStore)(),[f,g]=(0,c.useState)(null),{data:i,isLoading:k}=(a={equipe_id:e?.id||"",non_traitees:!0},(0,d.useQuery)({queryKey:["alerts",a],queryFn:()=>h.getAlerts(a),enabled:!!a.equipe_id,refetchInterval:3e4})),l=i?.filter(a=>"CRITIQUE"===a.niveau)||[],r=i?.filter(a=>"ATTENTION"===a.niveau)||[],s=i?.filter(a=>"INFO"===a.niveau)||[];return(0,b.jsxs)("div",{className:"p-8 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Alertes"}),(0,b.jsx)("p",{className:"text-slate-600 mt-1",children:"Surveillez les anomalies et agissez rapidement"})]}),i&&i.length>0&&(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsxs)(n.Badge,{variant:"destructive",className:"text-base",children:[i.length," alerte(s) active(s)"]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsx)(m.Card,{children:(0,b.jsxs)(m.CardContent,{className:"p-6 flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-lg bg-red-100 flex items-center justify-center",children:(0,b.jsx)(o.AlertTriangle,{className:"h-6 w-6 text-red-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:l.length}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"Critiques"})]})]})}),(0,b.jsx)(m.Card,{children:(0,b.jsxs)(m.CardContent,{className:"p-6 flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-lg bg-orange-100 flex items-center justify-center",children:(0,b.jsx)(p.AlertCircle,{className:"h-6 w-6 text-orange-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:r.length}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"Attention"})]})]})}),(0,b.jsx)(m.Card,{children:(0,b.jsxs)(m.CardContent,{className:"p-6 flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-lg bg-blue-100 flex items-center justify-center",children:(0,b.jsx)(q.Info,{className:"h-6 w-6 text-blue-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:s.length}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"Informations"})]})]})})]}),(0,b.jsxs)(H.Tabs,{defaultValue:"all",className:"space-y-4",children:[(0,b.jsxs)(H.TabsList,{children:[(0,b.jsxs)(H.TabsTrigger,{value:"all",children:["Toutes (",i?.length||0,")"]}),(0,b.jsxs)(H.TabsTrigger,{value:"CRITIQUE",children:["Critiques (",l.length,")"]}),(0,b.jsxs)(H.TabsTrigger,{value:"ATTENTION",children:["Attention (",r.length,")"]}),(0,b.jsxs)(H.TabsTrigger,{value:"INFO",children:["Info (",s.length,")"]})]}),(0,b.jsx)(H.TabsContent,{value:"all",children:k?(0,b.jsx)(m.Card,{children:(0,b.jsx)(m.CardContent,{className:"flex items-center justify-center h-96",children:(0,b.jsx)(C.Loader2,{className:"h-8 w-8 animate-spin text-primary"})})}):(0,b.jsx)(w,{alerts:i||[],onSelectAlert:g})}),(0,b.jsx)(H.TabsContent,{value:"CRITIQUE",children:(0,b.jsx)(w,{alerts:l,onSelectAlert:g})}),(0,b.jsx)(H.TabsContent,{value:"ATTENTION",children:(0,b.jsx)(w,{alerts:r,onSelectAlert:g})}),(0,b.jsx)(H.TabsContent,{value:"INFO",children:(0,b.jsx)(w,{alerts:s,onSelectAlert:g})})]}),(0,b.jsx)(G,{alerteId:f,open:!!f,onOpenChange:a=>!a&&g(null)})]})}a.s(["default",()=>I],49847)}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_alerts_page_tsx_2d158487._.js.map